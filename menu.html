<!doctype html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<style>
		.menuList
		{
			display: flex	;
			flex-wrap: wrap;
			justify-content: space-around;
			height: 58vh;
			overflow-y: auto;
			
		}

		.menuCard{
			border: solid #bbb 1px;
			padding: 10px;
			margin: 10px;
			box-shadow: 9px 10px 5px -5px #CACACA;
		}

		a, a:hover, a:active, a:visited{
			text-decoration: none;
			color: black;
		}

	</style>
	<title>早安公雞</title>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="./">早安公雞 農場晨食</a>
		<ul class="nav justify-content-center ml-auto">
			<li class="nav-item">
			  <a class="nav-link" href="./cart.html" >購物車</a>
			</li>
		</ul>
	</nav>

	<div class="d-flex flex-wrap justify-content-center" style="margin: 20px 50px;">
		<div class="col-12 col-sm-5 col-lg-4 d-flex flex-column justify-content-center" id="info">
		</div>
		<div class="col-12 col-sm-7 col-lg-8">
			<div id="carouselIndicators" class="carousel slide" data-ride="carousel">
				<ol class="carousel-indicators">
					<li data-target="#carouselIndicators" data-slide-to="0" class="active"></li>
					<li data-target="#carouselIndicators" data-slide-to="1"></li>
					<li data-target="#carouselIndicators" data-slide-to="2"></li>
				</ol>
				<div class="carousel-inner">
					<div class="carousel-item active">
						<img class="d-block w-100" src="./image/banner_1.jpg" alt="First slide">
					</div>
					<div class="carousel-item">
						<img class="d-block w-100" src="./image/banner_2.jpg" alt="Second slide">
					</div>
					<div class="carousel-item">
						<img class="d-block w-100" src="./image/banner_3.jpg" alt="Third slide">
					</div>
					<a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="sr-only">Previous</span>
					</a>
					<a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="sr-only">Next</span>
					</a>
				</div>
			</div>
		</div>
	</div>

	<hr>

	<div class="d-flex flex-wrap">
		<div class="col-4 col-lg-2 d-flex flex-wrap" style="max-height: 58vh; overflow-y: auto;">
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('A')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>公雞老麵堡</p>
			</div>
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('B')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>母雞蛋煎餅</p>
			</div>
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('C')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>小雞愛吐司<br>(抹醬系列)</p>
			</div>
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('D')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>小雞愛吐司</p>
			</div>
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('E')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>烏冬熱熱炒</p>
			</div>
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('F')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>農場小點心</p>
			</div>
			<div  class="d-flex flex-column align-items-center" style="width:150px; height: 30px;" onclick="getMenu('G')">
				<!-- <img src="./image/restaurant.png" alt="restaurant" style="width: 60%;"> -->
				<p>一日早晨飲</p>
			</div>
		</div>
		<div class="col-8 col-lg-10 menuList">

		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" integrity="sha512-uKQ39gEGiyUJl4AI6L+ekBdGKpGw4xJ55+xyJG7YFlJokPNYegn9KwQ3P8A7aFQAUtUsAQHep+d/lrGqrbPIDQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>

<div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="categoryModalLabel">加入購物車</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">X</button>
			</div>
			<div class="modal-body">
				<div id="catagory_A" class="options d-none">
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加蛋 +5">
					<label for="checkbox1">加蛋</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加起司 +10">
					<label for="checkbox1">加起司 +10</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加薯餅 +15">
					<label for="checkbox1">加薯餅 +15</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加肉排 +30">
					<label for="checkbox1">加肉排 +30</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加燻雞 +30">
					<label for="checkbox1">加燻雞 +30</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加火腿 +15">
					<label for="checkbox1">加火腿 +15</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加培根 +15">
					<label for="checkbox1">加培根 +15</label>
					</div>
					<div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="不要醬">
					<label for="checkbox1">不要醬</label>
					</div>
				</div>
				<div id="catagory_B" class="options d-none">
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加蛋 +5">
					<label for="checkbox1">加蛋</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加起司 +10">
					<label for="checkbox1">加起司 +10</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加薯餅 +15">
					<label for="checkbox1">加薯餅 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加肉排 +30">
					<label for="checkbox1">加肉排 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加燻雞 +30">
					<label for="checkbox1">加燻雞 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加火腿 +15">
					<label for="checkbox1">加火腿 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加培根 +15">
					<label for="checkbox1">加培根 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加玉米 +10">
					<label for="checkbox1">加玉米 +10</label>
				</div>
				</div>
			   <div id="catagory_C" class="options d-none">
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加蛋 +5">
					<label for="checkbox1">加蛋 +5</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加起司 +10">
					<label for="checkbox1">加起司 +10</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="去邊">
					<label for="checkbox1">去邊</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加薯餅 +15">
					<label for="checkbox1">加薯餅 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加肉排 +30">
					<label for="checkbox1">加肉排 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加燻雞 +30">
					<label for="checkbox1">加燻雞 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加火腿 +15">
					<label for="checkbox1">加火腿 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加培根 +15">
					<label for="checkbox1">加培根 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加玉米 +10">
					<label for="checkbox1">加玉米 +10</label>
				 </div>
			   </div>
			   <div id="catagory_D" class="options d-none">
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加蛋 +5">
					<label for="checkbox1">加蛋 +5</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加起司 +10">
					<label for="checkbox1">加起司 +10</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="去邊">
					<label for="checkbox1">去邊</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加薯餅 +15">
					<label for="checkbox1">加薯餅 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加肉排 +30">
					<label for="checkbox1">加肉排 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加燻雞 +30">
					<label for="checkbox1">加燻雞 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加火腿 +15">
					<label for="checkbox1">加火腿 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加培根 +15">
					<label for="checkbox1">加培根 +15</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加玉米 +10">
					<label for="checkbox1">加玉米 +10</label>
				 </div>
				</div>
			   <div id="catagory_E" class="options d-none">
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加半熟蛋 +20">
					<label for="checkbox1">加半熟蛋 +20</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加全熟蛋 +20">
					<label for="checkbox1">加全熟蛋 +20</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加半份麵 +30">
					<label for="checkbox1">加半份麵 +30</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="加整份麵 +35">
					<label for="checkbox1">加整份麵 +35</label>
			   </div>
			</div>
			   <div id="catagory_G" class="options d-none">
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="冰飲">
					<label for="checkbox1">冰飲</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="熱飲">
					<label for="checkbox1">熱飲</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="正常糖">
					<label for="checkbox1">正常糖</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="半糖">
					<label for="checkbox1">半糖</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="微糖">
					<label for="checkbox1">微糖</label>
				 </div>
				 <div class="form-group">
					<input type="checkbox" id="ckeckbox1" name="checkbox1" value="無糖">
					<label for="checkbox1">無糖</label>
				 </div>
			   </div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary btn-close" data-bs-dismiss="modal">Close</button>
				<button type="button" class="addCart btn btn-primary">加入購物車</button>
			</div>
		</div>
	</div>
</div>
</html>


<script>

	//get url parameter
	function getUrlParameter(sParam) {
		var sPageURL = window.location.search.substring(1),
			sURLVariables = sPageURL.split('&'),
			sParameterName,
			i;

		for(i = 0; i < sURLVariables.length; i++) {
			sParameterName = sURLVariables[i].split('=');

			if(sParameterName[0] === sParam) {
				return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
			}
		}
	};

	$.ajax({
		url: 'backend/restaurant.php?id=' + getUrlParameter('id'),
		method: 'GET',
		dataType: 'json',
		success: function(response) {
			if (response[0])
			{
				let _this = response[0];
				$('#info').empty();
				$('#info').append('<h3 id="restaurant_name">' + _this.name + '</h3>');
				$('#info').append('<h6>' + _this.address + '</h6>');
				$('#info').append('<h6>' + _this.telephone + '</h6>');
				$('#info').append('<div><i class="fa-solid fa-star"></i>&nbsp;' + _this.star + '</div>');
			}

		},
		error: function(xhr, status, error) {
			console.log('Request failed: ' + status);
		}
	});

	function getMenu(category)
	{
		$.ajax({
			url: 'backend/menu.php?category=' + category,
			method: 'GET',
			dataType: 'json',
			success: function(response) {
				console.log(response);
				$('.menuList').empty();	

				for (const i in response) {
					let _this = response[i];
					$('.menuList').append(`
							<div class="card menuCard" style="width: 18rem;">
								<img src="./image/${_this.image}" class="card-img-top" alt="meals-pic">
								<div class="card-body">
									<h5 class="card-title">${_this.name}</h5>
									<p class="card-text">NT$ ${_this.price}</p>
									<button class="CartOption btn btn-primary" data-category="${category}">加入購物車</button>
								</div>
							</div>
							`);
				}
			},
			error: function(xhr, status, error) {
				console.log('Request failed: ' + status);
			}
		});
	}

	$(document).ready(function() {

		let selected = null;

		getMenu('A');

		$(document).on('click', '.CartOption', function() {
			const category = $(this).data('category');
			$("#categoryModal").modal('show');
			$("#categoryModal").find('.options').addClass('d-none');
			$("#categoryModal").find('#catagory_' + category).removeClass('d-none');
			selected = $(this).parent().parent();
		});

		$(document).on('click', '.addCart', function() {
			let _this = selected;
			let name = _this.find('.card-title').text();
			let price = _this.find('.card-text').text().replace('NT$ ', '');
			let id = getUrlParameter('id');

			// find category which is displaying
			let category = null;
			$('.options').each(function() {
				if (!$(this).hasClass('d-none'))
				{
					category = $(this).attr('id').replace('catagory_', '');
				}
			});

			// get option checked in category
			let options = "";
			let option_price = 0;
			$('#catagory_' + category).find('input[type="checkbox"]').each(function() {
				if ($(this).is(':checked'))
				{
					options += $(this).val() + ',';
					var numb = $(this).val().match(/\d/g);
					numb = numb.join("");
					option_price += parseInt(numb);
				}
			});

			const restaurant_name = $('#restaurant_name').text();
			if (restaurant_name != localStorage.getItem('restaurant_name'))
			{
				localStorage.removeItem('cart');
			}
			localStorage.setItem('restaurant_name', restaurant_name);


			// add to local storage
			let cart = JSON.parse(localStorage.getItem('cart'));
			if (cart == null)
			{
				cart = [];
			}
			// else
			// {
			// 	for (const i in cart) {
			// 		if (cart[i].id == id && cart[i].name == name && cart[i].options == options)
			// 		{
			// 			cart[i].quantity++;
			// 			localStorage.setItem('cart', JSON.stringify(cart));
			// 			return;
			// 		}
			// 	}
			// }
			cart.push({
				'id': id,
				'name': name,
				'price': price,
				'quantity': 1,
				'options': options,
				'option_price': option_price,
			});
			localStorage.setItem('cart', JSON.stringify(cart));
			$("#categoryModal").modal('hide');
		});

		$('.btn-close').click(function() {
			$("#categoryModal").modal('hide');
		});
	});

</script>

